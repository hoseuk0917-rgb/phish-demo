import { WEIGHTS } from "./weights";

export type RuleStage = "info" | "verify" | "install" | "payment";

export type Rule = {
  id: string;
  label: string;
  stage: RuleStage;
  weight: number;
  patterns: RegExp[];
};

export const KEYWORD_RULES: Rule[] = [
  // ─────────────────────────────────────────────────────────────
  // VERIFY: OTP / 인증
  // ─────────────────────────────────────────────────────────────
  {
    id: "otp",
    label: "인증번호/OTP/승인번호(언급/요구)",
    stage: "verify",
    weight: WEIGHTS.otp,
    patterns: [
      /(otp|오티피|인증\s*번호|인증번호|인증\s*코드|인증코드|보안\s*코드|보안코드|확인\s*코드|확인코드|ars|2\s*단계\s*인증|승인\s*번호|승인번호|6\s*자리|6자리)/gi,
      /(인증번호|otp|오티피|승인번호|보안\s*코드|보안코드|확인\s*코드|확인코드|6\s*자리|6자리).{0,24}(불러|읽어|말해|알려|전달|보내|입력|캡처|대신\s*입력|대리\s*입력)/gi,
      /(불러|읽어|말해|알려|전달|보내|입력|캡처|대신\s*입력|대리\s*입력).{0,24}(인증번호|otp|오티피|승인번호|보안\s*코드|보안코드|확인\s*코드|확인코드|6\s*자리|6자리)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // INSTALL: 원격/설치/APK
  // ─────────────────────────────────────────────────────────────
  {
    id: "remote",
    label: "원격/원격앱/화면공유 유도",
    stage: "install",
    weight: WEIGHTS.installRemote,
    patterns: [
      /(원격\s*지원|원격지원|원격\s*제어|원격|화면\s*공유|화면공유|접속\s*코드|접속코드|원격\s*접속|원격\s*연결)/gi,
      /(팀뷰어|teamviewer|anydesk|애니데스크|퀵서포트|quicksupport)/gi,
    ],
  },
  {
    id: "apk",
    label: "APK/파일 설치 유도",
    stage: "install",
    weight: WEIGHTS.installRemote,
    patterns: [/(apk|\.apk|안드로이드\s*패키지|설치\s*파일)/gi],
  },
  {
    id: "install_app",
    label: "앱/뷰어 설치·다운로드 유도",
    stage: "install",
    weight: WEIGHTS.installRemote,
    patterns: [
      /(앱\s*설치|앱[’"'”]?\s*설치|전용\s*앱|보안\s*앱|보안앱|뷰어\s*설치|프로그램\s*설치|설치\s*후|설치가\s*필요|다운로드|다운\s*받|받아\s*서|업데이트|업뎃|권한\s*허용|접근성\s*권한|관리자\s*권한)/gi,
      /(스토어|플레이\s*스토어|구글\s*플레이|앱스토어|설치\s*링크)/gi,
      /(초대\s*코드|초대코드)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // VERIFY: 링크/단축링크 “문구” (실URL 없어도)
  // ─────────────────────────────────────────────────────────────
  {
    id: "link",
    label: "링크/주소/URL 문구(실URL 없이도 접속 유도)",
    stage: "verify",
    weight: 6,
    patterns: [
      /((링크|url|주소|사이트|페이지).*(눌러|클릭|접속|확인|로그인|인증|진행|신청|조회))/gi,
      /((눌러|클릭|접속|확인|로그인|인증|진행|신청|조회).*(링크|url|주소|사이트|페이지))/gi,
      /(링크|url|주소)\s*(확인|접속|클릭|눌러)/gi,
    ],
  },
  {
    id: "shortener",
    label: "단축 URL/단축링크 언급",
    stage: "verify",
    weight: 6,
    patterns: [
      /(bit\.ly|t\.co|tinyurl\.com|goo\.gl|me2\.do|han\.gl|url\.kr|vo\.la)/i,
      /(단축\s*링크|단축\s*url|짧은\s*링크)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // VERIFY: 투자/취업 훅(데모용)
  // ─────────────────────────────────────────────────────────────
  {
    id: "invest_lure",
    label: "투자/리딩방/정보방 유도",
    stage: "verify",
    weight: WEIGHTS.investLure,
    patterns: [
      /(투자|리딩방|정보\s*방|정보방|단톡|단체\s*방|채팅\s*방|채팅방|수익\s*인증|자동\s*투자|고수익|원금\s*보장|보장\s*수익|VIP|초대|초대장)/gi,
    ],
  },
  {
    id: "job_lure",
    label: "고액알바/해외 단기 고수익 제안",
    stage: "verify",
    weight: WEIGHTS.jobLure,
    patterns: [
      /(고액\s*알바|재택\s*알바|단기\s*고수익|고수익\s*알바|초보\s*가능|당일\s*지급|고정\s*수입|해외\s*(현지|프로젝트|업무)|출국\s*가능|숙식\s*제공|항공권\s*지원|구인|모집|채용|프로젝트\s*인력|인력\s*모집|면접|교육장)/gi,
      /(월\s*\d{2,}|하루\s*\d{1,3}\s*만).*(가능|이상|지급)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // PAYMENT: 송금/이체/입금/납부
  // ─────────────────────────────────────────────────────────────
  {
    id: "transfer",
    label: "송금/이체/입금/선입금/수수료 요구",
    stage: "payment",
    weight: WEIGHTS.money,
    patterns: [
      /((송금|이체|입금|납부|결제|정산|충전)\s*(해|해줘|해주|해주세요|해\s*줘|해\s*주|부탁|진행|요청))/gi,
      /(이체|송금|입금|납부|결제|정산|충전).*(하세요|해\s*주세요|해주셔야|해\s*주셔야|하십시오|바랍니다|부탁드립니다|진행\s*하세요|처리\s*하세요)/gi,
      /(납부|입금|송금|이체|결제)\s*(하|해)\s*(세요|십시오)/gi,

      /(선\s*입금|선입금|수수료|보험료|보증\s*보험료|보증보험료|합의금|보증금|위약금|예치\s*금|예치금|등록\s*비|등록비)/gi,

      /(\d[\d,]{1,}\s*(만\s*)?원).*(보내|보내줘|부쳐|부쳐줘|송금|이체|입금|납부|결제)/gi,
      /(보내|부쳐|송금|이체|입금|납부|결제).*(\d[\d,]{1,}\s*(만\s*)?원)/gi,

      // “입금하면 …” 계열(회귀에서 많이 빠짐)
      /(입금|충전)\s*하면/gi,
      /(입금|충전).*(하면\s*시작|후\s*시작|하면\s*됩니다|하면\s*돼|완료\s*됩니다|처리\s*됩니다)/gi,

      /(돈|금액|수수료|선입금|보험료|합의금|보증금|예치금|등록비).*(보내|부쳐|이체|송금|입금|납부|결제)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // VERIFY: 계정/본인/거래 확인
  // ─────────────────────────────────────────────────────────────
  {
    id: "account_verify",
    label: "계정/본인/계좌 인증·확인 유도",
    stage: "verify",
    weight: WEIGHTS.authority,
    patterns: [
      /(계좌).*(인증|확인|검증|점검|조회)/gi,
      /(본인).*(인증|확인|검증|점검)/gi,
      /(계정|아이디|id|로그인).*(인증|확인|검증|점검|복구|해제)/gi,
      /(비정상|이상).*(접속|로그인|시도|탐지|감지)/gi,
      /(계정).*(잠김|잠겼|잠겨|잠금|정지|차단|제한)/gi,
      /(복구|해제|차단\s*해제|정지\s*해제).*(진행|필요|요청)/gi,
    ],
  },
  {
    id: "txn_alert",
    label: "결제/이체 ‘시도·탐지’ 알림",
    stage: "verify",
    weight: WEIGHTS.threat,
    patterns: [
      /(해외\s*결제|해외결제|결제|이체|송금|승인)\s*(시도|탐지|감지|알림)/gi,
      /(승인|결제|이체|송금).*(대기|대기중)/gi,
      /(차단\s*대기|차단\s*대기중)/gi,
      /비정상\s*(결제|이체|송금|승인)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // PAYMENT: 안전/보호 계좌
  // ─────────────────────────────────────────────────────────────
  {
    id: "safe_account",
    label: "안전계좌/보호계좌 유도",
    stage: "payment",
    weight: WEIGHTS.safeAccount,
    patterns: [/(안전\s*계좌|안전계좌|보호\s*계좌|보호계좌|임시\s*계좌|임시계좌)/gi],
  },

  // ─────────────────────────────────────────────────────────────
  // VERIFY: 상품권/쿠폰(훅)
  // ─────────────────────────────────────────────────────────────
  {
    id: "social",
    label: "쿠폰/기프티콘/이벤트/상품권 훅",
    stage: "verify",
    weight: WEIGHTS.urgency,
    patterns: [/(기프티콘|상품권|쿠폰|경품|프로모션|이벤트|당첨|선물|핀번호|핀\s*번호|코드)/gi],
  },

  // ─────────────────────────────────────────────────────────────
  // VERIFY: 메신저/프로필 확인(낚시) — 가볍게
  // ─────────────────────────────────────────────────────────────
  {
    id: "messenger_phishing",
    label: "메신저/프로필 확인 유도",
    stage: "verify",
    weight: 2,
    patterns: [
      /(카카오톡|카톡|텔레그램|라인|디스코드|인스타(?:그램)?|DM|디엠|쪽지)\s*(프로필|채널|오픈\s*채팅|오픈채팅|대화방|채팅방)/gi,
      /(프로필|채널|오픈\s*채팅|오픈채팅|대화방|채팅방).*(확인|들어가|접속|입장|참여|눌러|클릭)/gi,
      /(프로필).*(링크|url|주소)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // VERIFY: 지원금/환급 훅(조회 단독 과매칭 방지)
  // ─────────────────────────────────────────────────────────────
  {
    id: "government_benefit",
    label: "지원금/환급/대상자 미끼",
    stage: "verify",
    weight: 1,
    patterns: [
      /(지원금|환급금?|보조금|장려금|정부\s*지원|추가\s*지급|미수령)/gi,
      /(재난\s*지원금|재난지원금|근로\s*장려금|근로장려금|자녀\s*장려금|소상공인\s*지원|소상공인지원|고용\s*보험|고용보험|실업\s*급여|실업급여)/gi,
      /(대상자).*(조회|확인)/gi,
      /(조회|확인).*(대상자)/gi,
      /(정부24|gov\s*24|gov24)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // VERIFY: 방문/출석/오시는길 (액션 확장)
  // ─────────────────────────────────────────────────────────────
  {
    id: "ctx_visit_place",
    label: "방문/출석/내방/장소 이동 유도",
    stage: "verify",
    weight: 5,
    patterns: [
      /(방문|내방|출석|출두|오세요|오셔|와\s*주|와줘|이동|도착|집결)/gi,
      /(오시는\s*길|주소|위치|지도|길\s*안내)/gi,
      /(면접장|교육장|사무실|지점|센터|창구|역앞|카페|공항|터미널)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // PAYMENT: ATM/현금 인출 + 지시동사 (액션 확장)
  // ─────────────────────────────────────────────────────────────
  {
    id: "go_bank_atm",
    label: "ATM/은행 방문·조작 지시",
    stage: "payment",
    weight: WEIGHTS.money,
    patterns: [
      /(atm|현금\s*인출|인출|출금|현금화|은행\s*가서|지점\s*가서|창구\s*가서|기기).{0,32}(가서|가\s*서|가\s*신\s*후|가신\s*후|눌러|누르|선택|입력|조작|진행|처리|뽑아|인출\s*해)/gi,
      /(가서|가\s*서|가신\s*후|가\s*신\s*후).{0,24}(atm|현금\s*인출|출금|인출|은행|지점|기기)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // INFO: 긴급/압박
  // ─────────────────────────────────────────────────────────────
  {
    id: "urgent",
    label: "긴급/즉시/압박(통화 유지 포함)",
    stage: "info",
    weight: WEIGHTS.urgency,
    patterns: [
      /(긴급|즉시|지금|바로|당장|오늘|오늘까지|곧|빨리|서둘러|급하게|중요|마감)/gi,
      /(통화).*(끊지\s*마|끊지마|유지)/gi,
      /(지금).*(가능|처리|진행)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // INFO: 비밀유지/검증 차단(검색·상담 금지/캡처·녹음 금지)
  // ─────────────────────────────────────────────────────────────
  {
    id: "ctx_secrecy",
    label: "비밀유지/검색·상담 차단/캡처·녹음 금지",
    stage: "info",
    weight: 6,
    patterns: [
      /(고객센터|공식\s*고객센터|은행\s*고객센터|카드사\s*고객센터|경찰\s*112|112|금감원|국번\s*없이\s*1332).{0,24}(전화|연락|문의).{0,10}(하지\s*마|하지마|하지\s*말|말라|금지)/gi,
      /(검색|인터넷|포털|네이버|구글|검색창).{0,24}(하지\s*마|하지마|하지\s*말|말라|금지)/gi,
      /(가족|지인|주변|회사|동료).{0,24}(알리|말하|공유|상담).{0,10}(지\s*마|지마|지\s*말|말라|금지)/gi,
      /(비밀|대외비|외부\s*공유\s*금지|절대\s*공유\s*금지|혼자만|본인만|단독으로)/gi,
      /(캡처|스크린\s*샷|스크린샷|사진|촬영|녹음).{0,16}(하지\s*마|하지마|하지\s*말|말라|금지)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // INFO: 권위/기관 사칭
  // ─────────────────────────────────────────────────────────────
  {
    id: "authority",
    label: "기관/담당자 사칭(권위)",
    stage: "info",
    weight: WEIGHTS.authority,
    patterns: [
      /(검찰|검찰청|지검|검사|경찰|경찰청|수사관|형사|사이버\s*수사)/gi,
      /(금감원|금융감독원|금융보안원|FIU|금융정보분석원|예금보험공사)/gi,
      /(은행|카드사|고객센터|보안팀|보안\s*팀|담당자|센터)/gi,
      /(KT|SKT|LGU\+|통신사)/gi,
      /(카카오|네이버)/gi,
      /(국세청|홈택스|정부24|행정안전부|고용노동부|근로복지공단|국민연금|국민건강보험|건강보험공단|교육청)/gi,
      /(검찰|경찰|금감원|금융감독원|국세청|법원|은행|카드사|고객센터)\s*(입니다|안내|연락|통지)/gi,
      /카드.{0,24}(분실|정지|재발급|발급|신고\s*접수|결제\s*차단)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // VERIFY: 연락처/오픈채팅/텔레그램 이동 (액션 확장)
  // ─────────────────────────────────────────────────────────────
  {
    id: "ctx_contact_move",
    label: "메신저/프로필/연락처 이동 유도",
    stage: "verify",
    weight: 6,
    patterns: [
      /(카카오톡|카톡|오픈\s*채팅|오픈채팅|오픈카톡|텔레그램|라인|디스코드|인스타(?:그램)?|DM|디엠|쪽지).*(이동|옮기|전환|넘어오|연락|문의|상담|추가|입장|참여)/gi,
      /(채널\s*추가|채널추가|친구\s*추가|친추)/gi,
      /((아이디|ID)\s*(검색|추가|확인)|아이디\s*검색|ID\s*검색|아이디\s*추가|ID\s*추가)/gi,
      /(프로필).*(확인|조회|눌러|클릭|들어가|접속)/gi,
      /(오픈\s*채팅|오픈채팅|채팅방|대화방).*(입장|참여|들어오|접속|링크)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // INFO: 위협/불이익
  // ─────────────────────────────────────────────────────────────
  {
    id: "threat",
    label: "불이익/위협/정지/범죄 프레이밍",
    stage: "info",
    weight: WEIGHTS.threat,
    patterns: [
      /(정지|차단|불이익|처벌|연체|압류|법적|지급\s*정지|지급정지|계좌\s*동결|통장\s*동결|압류|가압류|영장|체포|구속)/gi,
      /(범죄|대포\s*통장|대포통장|사건|수사\s*중|압수\s*수색|압수수색)/gi,
    ],
  },

  // ─────────────────────────────────────────────────────────────
  // VERIFY: 개인정보/자격정보
  // ─────────────────────────────────────────────────────────────
  {
    id: "personalinfo",
    label: "개인정보/자격정보 요구",
    stage: "verify",
    weight: WEIGHTS.personalInfo,
    patterns: [
      /(주민번호|주민\s*등록|신분증|여권|운전면허|면허증|인증서|공인\s*인증서|공동\s*인증서)/gi,
      /(계정|아이디|id|비밀번호|password)/gi,
      /(계좌번호|카드번호|보안카드|cvv|cvc)/gi,
      /(주소|서류\s*사진|신분증\s*사진|사진\s*보내)/gi,
      /(성함|연락처|전화번호|휴대폰|핸드폰|번호\s*좀)/gi,
    ],
  },
];
